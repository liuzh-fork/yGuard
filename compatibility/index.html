<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Compatibility - yGuard Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Compatibility";
        var mkdocs_page_input_path = "compatibility.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> yGuard Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">yGuard</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Compatibility</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#technical-requirements">Technical requirements</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#java-11-java-13-compatibility">Java 11 - Java 13 Compatibility</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#java-9-java-10-compatibility">Java 9 / Java 10 Compatibility</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#java-7-java-8-compatibility">Java 7 / Java 8 Compatibility</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#compatibility-to-3rd-party-jvm">Compatibility to 3rd party JVM</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#how-lambdametafactory-is-covered">How LambdaMetafactory is covered</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../license/">License</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../setup/">Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../task_documentation/">Task documentation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">yGuard Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li><li>Compatibility</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/yWorks/yGuard/edit/master/docs/compatibility.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="compatibility">Compatibility</h1>
<h2 id="technical-requirements">Technical requirements</h2>
<p>yGuard requires JDK 1.7.x or greater and Ant 1.5 or greater installed on your system. It may work with earlier versions of these pieces of software as well, however this has not been tested thoroughly. yGuard 1.3.x and upwards works together with Ant 1.6.</p>
<h2 id="java-11-java-13-compatibility">Java 11 - Java 13 Compatibility</h2>
<p>Beginning with version 2.10, yGuard supports obfuscation of Java class files that contain <code>nesthost</code> or <code>nestmembers</code> attributes which were introduced with the Java 11 <code>.class</code> file format. Further yGuard does support obfuscating <code>dynamic</code> instructions which were introduced with the Java 11 <code>.class</code> file format.</p>
<p>Please read the notes regarding 3rd party JVM support if you intend to use yGuard with something other than Java.</p>
<h2 id="java-9-java-10-compatibility">Java 9 / Java 10 Compatibility</h2>
<p>Beginning with version 2.7, yGuard supports obfuscation of Java class files that contain module information which was introduced with the Java 9 <code>.class</code> file format. yGuard does not change module names, though.</p>
<p>yGuard does <strong>not</strong> support obfuscating multi-release Java archives which were introduced with Java 9.</p>
<h2 id="java-7-java-8-compatibility">Java 7 / Java 8 Compatibility</h2>
<p>Beginning with version 2.5, yGuard supports obfuscation of Java class files that contain the <code>invokedynamic</code> instruction, which was introduced with the Java 7 <code>.class</code> file format. JDK 7 does not contain any means of issuing this instruction, with JDK 8 it is being issued when using lambda expressions or default methods.</p>
<p>While yGuard does fully support obfuscating <code>invokedynamic</code> instructions and therefore default methods and lambda expressions, shrinking of Java class files that contain this instruction is not supported yet.</p>
<h2 id="compatibility-to-3rd-party-jvm">Compatibility to 3rd party JVM</h2>
<p>Obfuscating <code>dynamic</code> and <code>invokedynamic</code> instructions is a task that is theoretically infeasible. An obfuscation program cannot determine the type and parameters of such instructions in a generic way.
A trade-off solution for this is supporting known <code>MetaFactory</code> objects by their signature.
The <code>JRE</code> makes this task quite trivial. 
<code>yGuard</code> supports the built-in <code>LambdaMetafactory</code> and <code>StringConcatFactory</code>.</p>
<p>This trade-off however means <code>yGuard</code> offers only limited support for instruction sets based on <code>invokedynamic</code> or <code>dynamic</code>.
In particular, supporting new <code>JVM</code> targets, such as Scala, might require manual work.
As we currently do not have the expertise, nor do we have the resources for this project, this is a chore left for the community.</p>
<p>Below is a documentation on the design process involved in supporting the <code>LambdaMetafactory</code>. It should serve as a base for anyone deciding to add more support for e.g Scala or Groovy.</p>
<h3 id="how-lambdametafactory-is-covered">How <code>LambdaMetafactory</code> is covered</h3>
<p>To check that JVM compatibility is ensured in new releases, we verified that there are no differences in the class file format in JVM &gt;= 11.
This can be checked in the documentation of the <a href="https://docs.oracle.com/javase/specs/jvms/se13/html/jvms-4.html">class file format</a>.
The JRE ships two targets for the <code>invokedynamic</code> and <code>dynamic</code> instruction sets. These are:</p>
<ul>
<li><code>LambdaMetafactory</code></li>
<li><code>StringConcatFactory</code></li>
</ul>
<p>We can recognise these factories in the obfuscation and shrinking steps using their signature. 
Looking at the <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/invoke/LambdaMetafactory.html">documentation</a> tells us that we should cover two signatures for <code>LambdaMetaFactory</code>:</p>
<ul>
<li><code>java/lang/invoke/LambdaMetafactory#metafactory</code></li>
<li><code>java/lang/invoke/LambdaMetafactory#altMetafactory</code></li>
</ul>
<p><code>yFiles</code> recognises these methods <a href="https://github.com/yWorks/yGuard/blob/master/retroguard/src/main/java/com/yworks/yguard/obf/classfile/ClassFile.java#L1189">during renaming</a>.
In order to obfuscate lambdas, these steps are performed:</p>
<ul>
<li>if an instance of <code>InvokeDynamicCpInfo</code> is found <a href="https://github.com/yWorks/yGuard/blob/master/retroguard/src/main/java/com/yworks/yguard/obf/classfile/ClassFile.java#L1041">while parsing the constant pool</a>, check its signature</li>
<li>if it has a <code>LambdaMetafactory</code> signature <a href="https://github.com/yWorks/yGuard/blob/master/retroguard/src/main/java/com/yworks/yguard/obf/classfile/ClassFile.java#L1046">handle the special case</a></li>
</ul>
<p>In the <code>LambdaMetafactoryTest</code> example, this will remap <code>com/yworks/yguard/obf/LambdaMetaFactoryTest$MyInterface;</code> to <code>La/a/a/a/a$_a;</code>. Most instances of lambda invocations will do a remapping on the JRE <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/util/function/package-summary.html">functional interface</a>.</p>
<p>However, this process must be carefully tested with actual Java byte code. Even though <code>StringConcatFactory</code> uses similar code, its semantics is completely different.
Implementing such a factory requires in-depth knowledge of the underlying mechanism. Even in the case of the <code>JDK</code> it is not always perfectly clear which case will be mapped by the compiler to which construct.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="yGuard"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../license/" class="btn btn-neutral float-right" title="License">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/yWorks/yGuard/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../license/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
